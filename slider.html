<!DOCTYPE html>
<html>
<head>
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
 <style>
  body {
   margin: 0;
   padding: 0;
   background: #111;
   font-family: Arial, sans-serif;
   color: white;
  }
  .swiper {
   width: 100vw;
   height: 100vh;
  }
  .swiper-slide {
   display: flex;
   justify-content: center;
   align-items: center;
   position: relative;
   background: #000;
  }
  .swiper-slide img {
   max-width: 100%;
   max-height: 100%;
   object-fit: contain;
  }
  .overlay {
   position: absolute;
   bottom: 0;
   width: 100%;
   background: rgba(0, 0, 0, 0.7); /* Fondo semi-transparente para legibilidad */
   padding: 15px;
   box-sizing: border-box;
   max-height: 50vh;
   overflow-y: auto; /* Permite scroll si el contenido es largo */
  }
  .overlay h2 {
   margin: 0 0 5px 0;
   font-size: 1.4em;
  }
  .overlay .description {
   margin: 0 0 10px 0;
   font-size: 1em;
   color: #ccc;
  }
  .overlay .comments-section {
   margin-top: 15px;
   border-top: 1px solid rgba(255,255,255,0.2);
   padding-top: 10px;
  }
  .overlay .comment {
   background: rgba(255, 255, 255, 0.1);
   padding: 8px;
   border-radius: 8px;
   margin-bottom: 5px;
   font-size: 0.9em;
   line-height: 1.3;
  }
 </style>
</head>
<body>
 <div class="swiper">
  <div class="swiper-wrapper"></div>
 </div>

 <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
 <script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu96yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec";
  let anunciosData = [];
  let swiperInstance; // Variable para la instancia de Swiper

  async function cargarImagenes() {
   try {
    const response = await fetch(`${SCRIPT_URL}?accion=listarAnuncios`);
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
   
    const data = await response.json();
    anunciosData = data.anuncios;
    const swiperWrapper = document.querySelector('.swiper-wrapper');
   
    anunciosData.forEach((anuncio) => {
     const slide = document.createElement('div');
     slide.classList.add('swiper-slide');
     // 游늷 Guardar los datos del anuncio en el slide
     slide.dataset.anuncio = JSON.stringify(anuncio);

     const img = document.createElement('img');
     img.src = anuncio.url;
     img.alt = anuncio.titulo || "";

     const overlay = document.createElement('div');
     overlay.classList.add('overlay');

     // 游늷 Crear y a침adir T칤tulo
     const titulo = document.createElement('h2');
     titulo.textContent = anuncio.titulo || 'Sin t칤tulo';
     overlay.appendChild(titulo);

     // 游늷 Crear y a침adir Descripci칩n
     const descripcion = document.createElement('p');
     descripcion.classList.add('description');
     descripcion.textContent = anuncio.descripcion || '';
     overlay.appendChild(descripcion);

     // 游늷 Crear y a침adir Comentarios
     if (anuncio.comentarios && anuncio.comentarios.trim() !== '') {
      const commentsSection = document.createElement('div');
      commentsSection.classList.add('comments-section');
      const comentariosArray = anuncio.comentarios.split('\n\n');
      comentariosArray.forEach(comentario => {
       if (comentario.trim() !== '') {
        const p = document.createElement('p');
        p.classList.add('comment');
        p.textContent = comentario.trim();
        commentsSection.appendChild(p);
       }
      });
      overlay.appendChild(commentsSection);
     }

     slide.appendChild(img);
     slide.appendChild(overlay);
     swiperWrapper.appendChild(slide);
    });

    swiperInstance = new Swiper('.swiper', {
     loop: true,
     direction: 'horizontal',
     slidesPerView: 1,
     spaceBetween: 10
    });

    // 游늷 Enviar los datos del primer slide al iniciar
    enviarDatosAAppInventor(swiperInstance.realIndex);

    // 游늷 Enviar datos cada vez que cambia el slide
    swiperInstance.on('slideChange', () => {
     const realIndex = swiperInstance.realIndex;
     enviarDatosAAppInventor(realIndex);
    });

   } catch (error) {
    console.error("Error al cargar las im치genes:", error);
   }
  }

  function enviarDatosAAppInventor(index) {
   if (window.AppInventor && anunciosData[index]) {
    window.AppInventor.setWebViewString(JSON.stringify(anunciosData[index]));
   }
  }

  cargarImagenes();
 </script>
</body>
</html>
